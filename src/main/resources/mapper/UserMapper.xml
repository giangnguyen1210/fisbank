<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fisbank.mapper.UserMapper">

    <insert id="createUser" parameterType="com.fisbank.dto.response.UserResponse">
        insert into users(
            "id",
            "name",
            "email",
            "password",
            "avatar",
            "role_id",
            "creator",
            "created_time"
        )VALUES(
           #{id},
           #{name},
           #{email},
           #{password},
           #{avatar},
           #{roleId},
            #{id},
            NOW()
        )


    </insert>
    <update id="editUser" parameterType="com.fisbank.dto.response.UserResponse">
        UPDATE users SET name = #{name},
                           email = #{email},
                           avatar = #{avatar},
                           role_id = #{roleId}
        WHERE id = #{id} and is_deleted=0
    </update>
    <update id="delete" parameterType="String">
        UPDATE users SET is_deleted = 1
        where id =#{id}
    </update>
    <!--    <select id="checkEmailExist" resultType="java.lang.Integer">-->
<!--        select count(*) from users where email=#{email} and id=#{id}-->

<!--    </select>-->
    <select id="checkEmailExist"
            resultType="Integer">
        SELECT COUNT(*) FROM "users" WHERE email = #{email}
    </select>

    <select id="getNextId" resultType="String">
        SELECT * FROM users ORDER BY id DESC LIMIT 1
    </select>
    <select id="getListUser" resultType="com.fisbank.dto.response.UserResponse">
        SELECT * From users where is_deleted = 0
    </select>

    <select id="totalUser" resultType="Integer">
        SELECT count(*) from users
    </select>

    <select id="countIdUser"
            parameterType="com.fisbank.dto.response.UserResponse"
            resultType="Integer">
        <![CDATA[
			SELECT COUNT(id) FROM users
		]]>
        <where>
            <if test="id != null and id !=''">
                AND id = #{id}
            </if>
        </where>
    </select>
    <select id="isUserDeleted" parameterType="String" resultType="java.lang.Integer">
        select * from users
          <where>
              <if test="id!=null and id!=''">
                  id=#{id} and is_deleted=1
              </if>
          </where>

    </select>
    <select id="findByUsername" resultType="com.fisbank.dto.response.UserResponse">
        select * from users where email=#{email} limit 1
    </select>
</mapper>